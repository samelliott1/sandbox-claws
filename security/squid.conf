# Squid Configuration for Sandbox Claws
# Purpose: Egress filtering to prevent data exfiltration

# ACL definitions
acl allowed_domains dstdomain "/etc/squid/allowed-domains.txt"
acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 443		# https
acl CONNECT method CONNECT

# Deny requests to unknown ports
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Only allow access to approved domains
http_access allow localhost
http_access allow allowed_domains
http_access deny all

# Proxy configuration
http_port 3128

# Logging - LOG EVERYTHING for audit
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log

# DNS configuration
dns_nameservers 8.8.8.8 8.8.4.4

# Cache settings (minimal for testing)
cache deny all

# Additional security headers
request_header_access X-Forwarded-For deny all
request_header_access Via deny all
request_header_access Cache-Control deny all

# Blocked content message
deny_info ERR_ACCESS_DENIED all

# Maximum object size (prevent large uploads)
request_body_max_size 10 MB
